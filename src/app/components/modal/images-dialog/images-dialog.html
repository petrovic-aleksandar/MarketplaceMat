<mat-card>
    <mat-card-header>
        <mat-card-title>Images</mat-card-title>
        <mat-card-subtitle>Manage item images</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
        @if (error()) {
        <div style="color: red; margin: 16px 0;">{{ error() }}</div>
        }

        @if (loading()) {
        <div style="display: flex; justify-content: center; padding: 32px;">
          <mat-spinner [diameter]="40"></mat-spinner>
        </div>
        } @else {
        @if (selectedImage()) {
        <img [src]="path()" class="img">
        }

        <table mat-table [dataSource]="images()">
            <tr mat-header-row *matHeaderRowDef="cols"></tr>
            <tr mat-row *matRowDef="let row; columns: cols;"></tr>
            <ng-container matColumnDef="path">
                <th mat-header-cell *matHeaderCellDef> Image </th>
                <td mat-cell *matCellDef="let i"> {{i.path}} </td>
            </ng-container>
            <ng-container matColumnDef="front">
                <th mat-header-cell *matHeaderCellDef> Front </th>
                <td mat-cell *matCellDef="let i"> {{i.front ? "Front" : ""}} </td>
            </ng-container>
            <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef> Actions </th>
                <td mat-cell *matCellDef="let i">
                    <button matButton="outlined" (click)="view(i)" [disabled]="i===selectedImage() || loading()">View</button>
                    <button matButton="outlined" (click)="makeFront(i)" [disabled]="i.front || loading()">Front</button>
                    <button matButton="outlined" (click)="delete(i)" [disabled]="i.front || loading()">Delete</button>
                </td>
            </ng-container>
        </table>
        }

        <input type="file" class="file-input" (change)="onFileSelected($event)" #fileUpload [disabled]="uploading()">
        <div class="file-upload">
            <button matButton="tonal" mat-mini-fab color="primary" class="upload-btn" (click)="fileUpload.click()" [disabled]="uploading() || loading()">
                <mat-icon>{{ uploading() ? 'hourglass_empty' : 'attach_file' }}</mat-icon>{{ uploading() ? 'Uploadingâ€¦' : 'Upload new image' }}
            </button>
        </div>
    </mat-card-content>
    <mat-card-actions>
        <div class="spacer"></div>
        <button mat-button type="button" (click)="close()" [disabled]="uploading() || loading()"><mat-icon>close</mat-icon>Close</button>
    </mat-card-actions>
</mat-card>